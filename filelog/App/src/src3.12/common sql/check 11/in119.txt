--exec PegPTAIconfig_prd_all_rework309554_11





select  distinct orderno,SUM(HandlingFee) as sumfee into #fee from (
			select mp.OrderNo, compgroup,HandlingFee
						from dcPegPTOrdersMP mp inner join 
			dbo.dcPegPTOrdersCV a on mp.OrderNo= a.OrderNo INNER JOIN dbo.rfSPCProductMasterHFee b 
			--ON a.CompID = b.ProductID 
			ON a.CompID = 
			case when a.MIOInd =0 and b.GroupList in('ScoreC&G') then '-1000' else b.ProductID end
			and a.OrderCreationDate between b.StartDate and b.EndDate
			inner join amSystemVariable am on b.grouplist=am.VarType and mp.DealerCode= case when b.grouplist='NA' then mp.DealerCode else am.VarValue end
			WHERE ISNULL(a.ProcessStatus,'')<>'R' 
			AND YEAR(a.OrderClosedDate)=2015
			AND MONTH(a.OrderClosedDate)=11
			
			-- add by ls 2015-12-14
			AND YEAR(mp.OrderClosedDate)=2015
			AND MONTH(mp.OrderClosedDate)=11
			
			and b.ARPUind =0
			and b.HFStatus=1
			and a.ActionType=1
			--and a.PayableInd=1
			and a.MIOInd <>'3'
			and b.HFType in(0,1)
			and b.HandLingFee is not null
			--and mp.OrderNo in()			
			group by mp.OrderNo,compgroup,HandlingFee
			) r
			group by orderno
	
	
	select count(*) from rfSPCProductMaster		

SELECT * FROM  #dcPegPTOrdersMP_cr309554 WHERE orderno='RKR5283002'
SELECT * FROM  #dcPegPTOrdersMP WHERE orderno='RKR5283002'

select * from  #fee WHERE orderno='RKR5283002'


select * from  dcPegPTOrdersCV where orderno='RKR5283002'
select mp.OrderNo, compgroup,HandlingFee
						from dcPegPTOrdersMP mp inner join 
			dbo.dcPegPTOrdersCV a on mp.OrderNo= a.OrderNo INNER JOIN dbo.rfSPCProductMasterHFee b 
			--ON a.CompID = b.ProductID 
			ON a.CompID = 
			case when a.MIOInd =0 and b.GroupList in('ScoreC&G') then '-1000' else b.ProductID end
			and a.OrderCreationDate between b.StartDate and b.EndDate
			and  a.orderno='RKR5283002'

			select * from  rfSPCProductMasterHFee where ProductID in('73269','73270','74701','74702','74841') 
		
			select * into rfSPCProductMasterHFee_20160101 from openrowset('sqloledb','10.54.14.193';'scoredb';'scDB@sn05',score.dbo.rfSPCProductMasterHFee)

			select * into rfSPCProductMasterHFee_bk_dev_20160101 from rfSPCProductMasterHFee
			truncate table rfSPCProductMasterHFee 
			insert into rfSPCProductMasterHFee(					
	[ProductID]      ,
	[StartDate]      ,
	[EndDate]        ,
	[HandLingFee]    ,
	[HandLingFee2]   ,
	[ARPUInd]        ,
	[HFType]         ,
	[HFStatus]       ,
	[CombInd]        ,
	[GroupList]      ,
	[AddedPoint]     ,

	[CompGroup]      
			) select 	[ProductID]      ,
	[StartDate]      ,
	[EndDate]        ,
	[HandLingFee]    ,
	[HandLingFee2]   ,
	[ARPUInd]        ,
	[HFType]         ,
	[HFStatus]       ,
	[CombInd]        ,
	[GroupList]      ,
	[AddedPoint]     ,

	[CompGroup]   from rfSPCProductMasterHFee_20160101


			select * from rfSPCProductMasterHFee_20160101
